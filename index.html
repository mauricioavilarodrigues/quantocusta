<!DOCTYPE html>
<html lang="pt-br">
<head>
<meta charset="UTF-8">
<title>quantocusta</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
body{font-family:Arial;background:#f6f7fb;padding:20px}
h1{text-align:center}
.topo,.filtros,.busca{display:flex;justify-content:center;gap:8px;flex-wrap:wrap;margin-bottom:12px}
button{border:none;padding:10px 16px;border-radius:20px;background:#e0e3ff;font-weight:bold;cursor:pointer}
button.ativo{background:#4f5dff;color:white}
ul{list-style:none;padding:0;max-width:600px;margin:auto}
li{background:white;margin:6px 0;padding:10px;border-radius:10px;display:flex;justify-content:space-between;align-items:center}
.preco{color:#4f5dff;font-weight:bold}
.caixa{background:white;padding:12px;border-radius:12px;margin-top:20px;max-width:600px;margin:auto}
.menor{border:2px solid #4f5dff}
.quantidade{width:40px;margin-left:10px;text-align:center;border-radius:6px;padding:2px}
</style>
</head>

<body>

<h1>ðŸ’° quantocusta</h1>

<!-- Nichos -->
<div class="topo">
<button onclick="setNicho('supermercado',this)">ðŸ›’ Supermercado</button>
<button onclick="setNicho('combustivel',this)">â›½ CombustÃ­vel</button>
<button onclick="setNicho('farmacia',this)">ðŸ’Š FarmÃ¡cia</button>
</div>

<!-- Filtros -->
<div id="filtroSupermercado" class="filtros" style="display:none;">
<button onclick="setCategoria('alimento',this)">ðŸ¥¦ Alimentos</button>
<button onclick="setCategoria('limpeza',this)">ðŸ§¼ Limpeza</button>
</div>

<div id="filtroCombustivel" class="filtros" style="display:none;">
<button onclick="setTipo('Comum',this)">Comum</button>
<button onclick="setTipo('Aditivada',this)">Aditivada</button>
</div>

<div id="filtroFarmacia" class="filtros" style="display:none;">
<button onclick="setCategoriaFarmacia('remedio',this)">ðŸ’Š RemÃ©dios</button>
<button onclick="setCategoriaFarmacia('higiene',this)">ðŸ§´ Higiene</button>
</div>

<!-- Filtro por cidade -->
<div class="filtros">
<input id="cidade" placeholder="Cidade..." oninput="buscar()">
</div>

<!-- Busca -->
<div class="busca">
<input id="busca" placeholder="Buscar...">
<button onclick="buscar()">Buscar</button>
</div>

<ul id="resultado"></ul>

<!-- Cesta -->
<div class="caixa">
<h3>ðŸ§º Cesta</h3>
<ul id="cestaLista"></ul>
<button onclick="compararCesta()">Comparar cesta</button>
<div id="cestaResultado"></div>
</div>

<script>
let nichoAtual="",tipoAtual="",categoriaAtual="",categoriaFarmaciaAtual="";
let cesta={}; // chave = produto.id, valor = {produto, quantidade}

// limpar botÃµes ativos
function limparAtivos(grupo){document.querySelectorAll(grupo+" button").forEach(b=>b.classList.remove("ativo"));}

// seleÃ§Ã£o de nicho e filtros
function setNicho(n,b){
    nichoAtual=n;tipoAtual="";categoriaAtual="";categoriaFarmaciaAtual="";
    document.getElementById("resultado").innerHTML="";
    limparAtivos(".topo"); b.classList.add("ativo");
    ["Supermercado","Combustivel","Farmacia"].forEach(f=>document.getElementById("filtro"+f).style.display="none");
    if(n=="supermercado")filtroSupermercado.style.display="flex";
    if(n=="combustivel")filtroCombustivel.style.display="flex";
    if(n=="farmacia")filtroFarmacia.style.display="flex";
}

function setTipo(t,b){tipoAtual=t;limparAtivos("#filtroCombustivel");b.classList.add("ativo");buscar();}
function setCategoria(c,b){categoriaAtual=c;limparAtivos("#filtroSupermercado");b.classList.add("ativo");buscar();}
function setCategoriaFarmacia(c,b){categoriaFarmaciaAtual=c;limparAtivos("#filtroFarmacia");b.classList.add("ativo");buscar();}

// busca de produtos
async function buscar(){
    if(!nichoAtual)return;
    if(nichoAtual=="combustivel"&&!tipoAtual)return;
    if(nichoAtual=="supermercado"&&!categoriaAtual)return;
    if(nichoAtual=="farmacia"&&!categoriaFarmaciaAtual)return;

    const termo=busca.value.toLowerCase();
    const cidadeFiltro=document.getElementById("cidade").value.toLowerCase();
    
    // buscar via API ou JSON local
    const res=await fetch("data.json");
    const data=await res.json();

    let itens=data[nichoAtual].filter(p=>{
        let ok=true;
        if(termo && !p.nome.toLowerCase().includes(termo)) ok=false;
        if(nichoAtual=="combustivel" && tipoAtual && !p.nome.includes(tipoAtual)) ok=false;
        if(nichoAtual=="supermercado" && categoriaAtual && p.tipo!=categoriaAtual) ok=false;
        if(nichoAtual=="farmacia" && categoriaFarmaciaAtual && p.tipo!=categoriaFarmaciaAtual) ok=false;
        if(cidadeFiltro && !p.cidade.toLowerCase().includes(cidadeFiltro)) ok=false;
        return ok;
    });

    mostrarResultados(itens);
}

// mostrar resultados
function mostrarResultados(itens){
    const resultado=document.getElementById("resultado");
    resultado.innerHTML="";
    itens.forEach(p=>{
        const li=document.createElement("li");
        li.innerHTML=`<span>
            <input type="number" min="0" value="${cesta[p.id]?.quantidade||0}" class="quantidade" onchange='atualizarCesta(${JSON.stringify(p)}, this.value)'> 
            ${p.nome}<br><small>${p.loja||p.posto} - ${p.cidade}</small>
        </span>
        <span class="preco">R$ ${p.preco.toFixed(2)}</span>`;
        resultado.appendChild(li);
    });
}

// adicionar/atualizar cesta
function atualizarCesta(p, q){
    q=parseInt(q);
    if(q>0)cesta[p.id]={produto:p, quantidade:q};
    else delete cesta[p.id];
    mostrarCesta();
}

// mostrar cesta
function mostrarCesta(){
    const lista=document.getElementById("cestaLista");
    lista.innerHTML="";
    for(let k in cesta){
        let item=cesta[k];
        let li=document.createElement("li");
        li.innerHTML=`${item.produto.nome} x${item.quantidade} - R$ ${(item.produto.preco*item.quantidade).toFixed(2)}`;
        lista.appendChild(li);
    }
}

// comparar cesta
function compararCesta(){
    let porLoja={};
    for(let k in cesta){
        let item=cesta[k];
        let l=item.produto.loja||item.produto.posto;
        porLoja[l]=(porLoja[l]||0)+(item.produto.preco*item.quantidade);
    }
    let html="<h3>Resultado da cesta</h3>";
    let menor=Infinity;
    for(let l in porLoja) menor=Math.min(menor,porLoja[l]);
    for(let l in porLoja){
        let cls=porLoja[l]==menor?"menor":"";
        html+=`<div class="${cls}">${l}: R$ ${porLoja[l].toFixed(2)}</div>`;
    }
    document.getElementById("cestaResultado").innerHTML=html;
}
</script>

</body>
</html>
