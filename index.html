<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8">
  <title>quantocusta</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <style>
    body {
      font-family: Arial, sans-serif;
      background: #f6f7fb;
      margin: 0;
      padding: 20px;
    }

    h1 {
      text-align: center;
      color: #333;
    }

    .topo {
      display: flex;
      justify-content: center;
      gap: 10px;
      margin-bottom: 10px;
      flex-wrap: wrap;
    }

    button {
      border: none;
      padding: 10px 16px;
      border-radius: 20px;
      background: #e0e3ff;
      cursor: pointer;
      font-weight: bold;
      transition: .2s;
    }

    button:hover {
      background: #c9ceff;
    }

    button.ativo {
      background: #4f5dff;
      color: white;
    }

    .filtros {
      display: flex;
      justify-content: center;
      gap: 8px;
      margin-bottom: 12px;
      flex-wrap: wrap;
    }

    .busca {
      display: flex;
      justify-content: center;
      gap: 6px;
      margin-bottom: 15px;
    }

    input {
      padding: 10px;
      border-radius: 20px;
      border: 1px solid #ccc;
      width: 220px;
    }

    ul {
      list-style: none;
      padding: 0;
      max-width: 500px;
      margin: auto;
    }

    li {
      background: white;
      margin-bottom: 10px;
      padding: 12px;
      border-radius: 12px;
      box-shadow: 0 2px 6px rgba(0,0,0,.08);
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 10px;
    }

    .preco {
      font-weight: bold;
      color: #4f5dff;
    }

    .menor {
      border: 2px solid #4f5dff;
    }

    .cestaBox{
      background:white;
      margin-top:20px;
      padding:12px;
      border-radius:12px;
      box-shadow:0 2px 6px rgba(0,0,0,.08);
      max-width:500px;
      margin-left:auto;
      margin-right:auto;
    }

    .itemCesta{
      display:flex;
      justify-content:space-between;
      margin:4px 0;
    }
  </style>
</head>

<body>

<h1>üí∞ quantocusta</h1>

<div class="topo">
  <button onclick="setNicho('supermercado',this)">üõí Supermercado</button>
  <button onclick="setNicho('combustivel',this)">‚õΩ Combust√≠vel</button>
  <button onclick="setNicho('farmacia',this)">üíä Farm√°cia</button>
</div>

<div id="filtroSupermercado" class="filtros" style="display:none;">
  <button onclick="setCategoria('alimento',this)">ü•¶ Alimentos</button>
  <button onclick="setCategoria('limpeza',this)">üßº Limpeza</button>
</div>

<div id="filtroCombustivel" class="filtros" style="display:none;">
  <button onclick="setTipo('Comum',this)">Comum</button>
  <button onclick="setTipo('Aditivada',this)">Aditivada</button>
</div>

<div id="filtroFarmacia" class="filtros" style="display:none;">
  <button onclick="setCategoriaFarmacia('remedio',this)">üíä Rem√©dios</button>
  <button onclick="setCategoriaFarmacia('higiene',this)">üß¥ Higiene</button>
</div>

<div class="busca">
  <input id="busca" placeholder="Buscar...">
  <button onclick="buscar()">Buscar</button>
</div>

<ul id="resultado"></ul>

<button onclick="compararCesta()" style="margin:20px auto;display:block;">
üß∫ Comparar cesta
</button>

<div id="cestaResultado"></div>

<script>
let nichoAtual="", tipoAtual="", categoriaAtual="", categoriaFarmaciaAtual="";
let cesta=[];

function limparAtivos(grupo){
  document.querySelectorAll(grupo+" button").forEach(b=>b.classList.remove("ativo"));
}

function setNicho(nicho,btn){
  nichoAtual=nicho;
  tipoAtual=""; categoriaAtual=""; categoriaFarmaciaAtual="";
  document.getElementById("resultado").innerHTML="";
  document.getElementById("cestaResultado").innerHTML="";
  cesta=[];

  limparAtivos(".topo");
  btn.classList.add("ativo");

  document.getElementById("filtroSupermercado").style.display="none";
  document.getElementById("filtroCombustivel").style.display="none";
  document.getElementById("filtroFarmacia").style.display="none";

  if(nicho==="supermercado") document.getElementById("filtroSupermercado").style.display="flex";
  if(nicho==="combustivel") document.getElementById("filtroCombustivel").style.display="flex";
  if(nicho==="farmacia") document.getElementById("filtroFarmacia").style.display="flex";
}

function setTipo(t,btn){ tipoAtual=t; limparAtivos("#filtroCombustivel"); btn.classList.add("ativo"); buscar(); }
function setCategoria(c,btn){ categoriaAtual=c; limparAtivos("#filtroSupermercado"); btn.classList.add("ativo"); buscar(); }
function setCategoriaFarmacia(c,btn){ categoriaFarmaciaAtual=c; limparAtivos("#filtroFarmacia"); btn.classList.add("ativo"); buscar(); }

async function buscar(){
  if(!nichoAtual) return;
  if(nichoAtual==="combustivel"&&!tipoAtual) return;
  if(nichoAtual==="supermercado"&&!categoriaAtual) return;
  if(nichoAtual==="farmacia"&&!categoriaFarmaciaAtual) return;

  const termo=document.getElementById("busca").value.toLowerCase();
  const res=await fetch("data.json");
  const data=await res.json();

  let itens=data[nichoAtual].filter(p=>p.nome.toLowerCase().includes(termo));

  if(nichoAtual==="combustivel") itens=itens.filter(p=>p.nome.toLowerCase().includes(tipoAtual.toLowerCase()));
  if(nichoAtual==="supermercado") itens=itens.filter(p=>p.tipo===categoriaAtual);
  if(nichoAtual==="farmacia") itens=itens.filter(p=>p.tipo===categoriaFarmaciaAtual);

  itens.sort((a,b)=>a.preco-b.preco);

  const lista=document.getElementById("resultado");
  lista.innerHTML="";

  itens.forEach((p,i)=>{
    const li=document.createElement("li");
    if(i===0) li.classList.add("menor");

    const local=p.loja||p.posto||"";

    li.innerHTML=`
      <label>
        <input type="checkbox" onchange='toggleCesta(${JSON.stringify(p)})'>
        ${p.nome}<br><small>${local}</small>
      </label>
      <span class="preco">R$ ${p.preco.toFixed(2)}</span>
    `;

    lista.appendChild(li);
  });
}

function toggleCesta(produto){
  const existe=cesta.find(p=>p.nome===produto.nome&&p.preco===produto.preco);
  if(existe){
    cesta=cesta.filter(p=>!(p.nome===produto.nome&&p.preco===produto.preco));
  }else{
    cesta.push(produto);
  }
}

function compararCesta(){
  const box=document.getElementById("cestaResultado");
  box.innerHTML="";

  if(cesta.length===0){
    box.innerHTML="<p style='text-align:center'>Selecione produtos primeiro.</p>";
    return;
  }

  const porLoja={};

  cesta.forEach(p=>{
    const local=p.loja||p.posto;
    if(!porLoja[local]) porLoja[local]=0;
    porLoja[local]+=p.preco;
  });

  let html="<div class='cestaBox'><h3>üß∫ Sua cesta</h3>";

  cesta.forEach(p=>{
    html+=`<div class='itemCesta'><span>${p.nome}</span><span>R$ ${p.preco.toFixed(2)}</span></div>`;
  });

  html+="<hr><h4>Totais por loja</h4>";

  let menor=Infinity, melhor="";

  for(let loja in porLoja){
    if(porLoja[loja]<menor){
      menor=porLoja[loja];
      melhor=loja;
    }
    html+=`<div class='itemCesta'><span>${loja}</span><span>R$ ${porLoja[loja].toFixed(2)}</span></div>`;
  }

  html+=`<hr><strong>‚≠ê Melhor op√ß√£o: ${melhor} ‚Äî R$ ${menor.toFixed(2)}</strong></div>`;

  box.innerHTML=html;
}
</script>

</body>
</html>
