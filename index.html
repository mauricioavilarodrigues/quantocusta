<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8">
  <title>quantocusta</title>
</head>

<body>
  <h1>quantocusta</h1>

  <div>
    <button onclick="setNicho('supermercado')">üõí Supermercado</button>
    <button onclick="setNicho('combustivel')">‚õΩ Combust√≠vel</button>
  </div>

  <!-- Filtro supermercado -->
  <div id="filtroSupermercado" style="display:none; margin-left:20px; margin-top:8px;">
    <button onclick="setCategoria('alimento')">ü•¶ Alimentos</button>
    <button onclick="setCategoria('limpeza')">üßº Limpeza</button>
  </div>

  <!-- Filtro combust√≠vel -->
  <div id="filtroCombustivel" style="display:none; margin-left:20px; margin-top:8px;">
    <button onclick="setTipo('Comum')">Comum</button>
    <button onclick="setTipo('Aditivada')">Aditivada</button>
  </div>

  <br>

  <input id="busca" placeholder="Buscar produto...">
  <button onclick="buscar()">Buscar</button>

  <ul id="resultado"></ul>

  <script>
    let nichoAtual = "supermercado";
    let tipoAtual = "";
    let categoriaAtual = "";

    function setNicho(nicho) {
      nichoAtual = nicho;
      tipoAtual = "";
      categoriaAtual = "";

      document.getElementById("filtroCombustivel").style.display = "none";
      document.getElementById("filtroSupermercado").style.display = "none";

      if (nicho === "combustivel") {
        document.getElementById("filtroCombustivel").style.display = "block";
      }

      if (nicho === "supermercado") {
        document.getElementById("filtroSupermercado").style.display = "block";
      }

      buscar();
    }

    function setTipo(tipo) {
      tipoAtual = tipo;
      buscar();
    }

    function setCategoria(cat) {
      categoriaAtual = cat;
      buscar();
    }

    async function buscar() {
      const termo = document.getElementById("busca").value.toLowerCase();
      const res = await fetch("data.json");
      const data = await res.json();

      const lista = document.getElementById("resultado");
      lista.innerHTML = "";

      const itens = data[nichoAtual];

      if (!itens) {
        lista.innerHTML = "<li>Nenhum dado encontrado.</li>";
        return;
      }

      let filtrados = itens.filter(p =>
        p.nome.toLowerCase().includes(termo)
      );

      if (nichoAtual === "combustivel" && tipoAtual) {
        filtrados = filtrados.filter(p =>
          p.nome.toLowerCase().includes(tipoAtual.toLowerCase())
        );
      }

      if (nichoAtual === "supermercado" && categoriaAtual) {
        filtrados = filtrados.filter(p =>
          p.tipo === categoriaAtual
        );
      }

      filtrados
        .sort((a, b) => a.preco - b.preco)
        .forEach((p, i) => {
          const li = document.createElement("li");
          const local = p.loja || p.posto;
          const destaque = i === 0 ? " ‚≠ê MENOR PRE√áO" : "";

          li.innerText = `${p.nome} - R$ ${p.preco.toFixed(2)} - ${local}${destaque}`;
          lista.appendChild(li);
        });
    }
  </script>

</body>
</html>
